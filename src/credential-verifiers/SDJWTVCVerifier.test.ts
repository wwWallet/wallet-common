import { assert, describe, expect, it } from "vitest";
import { Context } from "../interfaces";
import { SDJWTVCVerifier } from "./SDJWTVCVerifier";
import { PublicKeyResolverEngine } from "../PublicKeyResolverEngine";
import { CredentialVerificationError } from "../error";

const wrongFormatCredential = `omppc3N1ZXJBdXRohEOhASahGCGCWQJ4MIICdDCCAhugAwIBAgIBAjAKBggqhkjOPQQDAjCBiDELMAkGA1UEBhMCREUxDzANBgNVBAcMBkJlcmxpbjEdMBsGA1UECgwUQnVuZGVzZHJ1Y2tlcmVpIEdtYkgxETAPBgNVBAsMCFQgQ1MgSURFMTYwNAYDVQQDDC1TUFJJTkQgRnVua2UgRVVESSBXYWxsZXQgUHJvdG90eXBlIElzc3VpbmcgQ0EwHhcNMjQwNTMxMDgxMzE3WhcNMjUwNzA1MDgxMzE3WjBsMQswCQYDVQQGEwJERTEdMBsGA1UECgwUQnVuZGVzZHJ1Y2tlcmVpIEdtYkgxCjAIBgNVBAsMAUkxMjAwBgNVBAMMKVNQUklORCBGdW5rZSBFVURJIFdhbGxldCBQcm90b3R5cGUgSXNzdWVyMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEOFBq4YMKg4w5fTifsytwBuJf_7E7VhRPXiNm52S3q1ETIgBdXyDK3kVxGxgeHPivLP3uuMvS6iDEc7qMxmvduKOBkDCBjTAdBgNVHQ4EFgQUiPhCkLErDXPLW2_J0WVeghyw-mIwDAYDVR0TAQH_BAIwADAOBgNVHQ8BAf8EBAMCB4AwLQYDVR0RBCYwJIIiZGVtby5waWQtaXNzdWVyLmJ1bmRlc2RydWNrZXJlaS5kZTAfBgNVHSMEGDAWgBTUVhjAiTjoDliEGMl2Yr-ru8WQvjAKBggqhkjOPQQDAgNHADBEAiAbf5TzkcQzhfWoIoyi1VN7d8I9BsFKm1MWluRph2byGQIgKYkdrNf2xXPjVSbjW_U_5S5vAEC5XxcOanusOBroBbVZAn0wggJ5MIICIKADAgECAhQHkT1BVm2ZRhwO0KMoH8fdVC_vaDAKBggqhkjOPQQDAjCBiDELMAkGA1UEBhMCREUxDzANBgNVBAcMBkJlcmxpbjEdMBsGA1UECgwUQnVuZGVzZHJ1Y2tlcmVpIEdtYkgxETAPBgNVBAsMCFQgQ1MgSURFMTYwNAYDVQQDDC1TUFJJTkQgRnVua2UgRVVESSBXYWxsZXQgUHJvdG90eXBlIElzc3VpbmcgQ0EwHhcNMjQwNTMxMDY0ODA5WhcNMzQwNTI5MDY0ODA5WjCBiDELMAkGA1UEBhMCREUxDzANBgNVBAcMBkJlcmxpbjEdMBsGA1UECgwUQnVuZGVzZHJ1Y2tlcmVpIEdtYkgxETAPBgNVBAsMCFQgQ1MgSURFMTYwNAYDVQQDDC1TUFJJTkQgRnVua2UgRVVESSBXYWxsZXQgUHJvdG90eXBlIElzc3VpbmcgQ0EwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAARgbN3AUOdzv4qfmJsC8I4zyR7vtVDGp8xzBkvwhogD5YJE5wJ-Zj-CIf3aoyu7mn-TI6K8TREL8ht0w428OhTJo2YwZDAdBgNVHQ4EFgQU1FYYwIk46A5YhBjJdmK_q7vFkL4wHwYDVR0jBBgwFoAU1FYYwIk46A5YhBjJdmK_q7vFkL4wEgYDVR0TAQH_BAgwBgEB_wIBADAOBgNVHQ8BAf8EBAMCAYYwCgYIKoZIzj0EAwIDRwAwRAIgYSbvCRkoe39q1vgx0WddbrKufAxRPa7XfqB22XXRjqECIG5MWq9Vi2HWtvHMI_TFZkeZAr2RXLGfwY99fbsQjPOzWQS62BhZBLWnZnN0YXR1c6Frc3RhdHVzX2xpc3SiY2lkeBhsY3VyaXhWaHR0cHM6Ly9kZW1vLnBpZC1pc3N1ZXIuYnVuZGVzZHJ1Y2tlcmVpLmRlL3N0YXR1cy84ODc5M2MwMy0xNmFkLTQ0NjgtYmVmNy1jMDgzZDM4YWUyMTlnZG9jVHlwZXdldS5ldXJvcGEuZWMuZXVkaS5waWQuMWd2ZXJzaW9uYzEuMGx2YWxpZGl0eUluZm-jZnNpZ25lZMB0MjAyNS0wMi0xOFQxNDoxMjowNFppdmFsaWRGcm9twHQyMDI1LTAyLTE4VDE0OjEyOjA0Wmp2YWxpZFVudGlswHQyMDI1LTAzLTA0VDE0OjEyOjA0Wmx2YWx1ZURpZ2VzdHOhd2V1LmV1cm9wYS5lYy5ldWRpLnBpZC4xtgBYIKuGxnFMGhNio5-VUJKePlkmw33mloMA9fgqUR0ynOoJAVggWxNyUrVxTPW2riSGxx_U_irluD-vcJIOGGrafGo6JpwCWCDKOCdlxlbeX7mztFkzrM7MsZHs3gEyrmC79X3N2VpxkgNYICmI6iaQPBePM7fzBXqPyX5Gr-wNnWNCNb7wDUz4VDIRBFggfCuu8bFboi9BiRPsM447Ncg9A7K7A28iTEjVy9fmjBIFWCC6z1AlQM8ttJfuIQtPYlurlamh3MvAbSaQoUzAn-9L9gZYIKD1mVbZ5zb-_sp_E6vZCQ_U2QAQVNtbWAznR4xUm6LoB1ggWAn0OSPMM-m8NbgBZ-D6qLV0BEVeSnR4DIsUPUOZDbsIWCDyTDBH9XjK_JIq_W7d19UpmMq1pd1CjrmhfIHsctg3gwlYIK7ejRc3g-pfNGM0WHv4Oh1jfshl03Jvm3cxKHFnIIXmClggjPVDgZmiJEpnM6Zo_mzUQAbW5M6QZuRH43L6BqVeT7wLWCCSVNDu2CjnRkbC7_6m6-G6h8dTDWvlmGz0WD-MUCGERwxYIDpAXdFHgnACMgICXQpJi9nzBDRjsJ8bY1htM9GtgZlKDVggvhyWJk8WGQgokFghnd9DyZKyo8b6VrfAX8WTB0vH1QkOWCBLJFY_nbKL1x-5fbJCqS1IgEn_uMm9NJm2vqorCWwwPg9YIJIg7rTS_E3HAYjcjdV6WSpgZuXa8IKo7f5aC9ibPXQzEFggc_BlS8FdmjVtSqXrA2Xh58naoO0XdTbwclGo9itNTIERWCDzIo5muAIWaawEG69bUPG4mI4pEB5dUhadaUeMUEuwIhJYIEALsAqnwl3T1nC7YtOeDj-7OEHlmcwhCZjY2Qgsr2vCE1ggwG6In0GuGqO1isPXfh2EA7-mi18JAhfumCyQUA5FpYYUWCAL6kBisfFYUIU06t2d0UeqElM-c49VrVqfgYYSIx2JpRVYICYx93c95xCPFdhE03ZlReMnLGSjT_SJgEBMeErv0VlXbWRldmljZUtleUluZm-haWRldmljZUtleaQBAiABIVgganiJYJ0goJBbFzWZ52BDtTvTP1Fqb6k80C4UBl6JrFwiWCCWf2o4RIOTRI_UGubc0rCyIDo-o_LYRzYRnWzos3gcSm9kaWdlc3RBbGdvcml0aG1nU0hBLTI1NlhAcBP9-i1suGc_TnH7z4Mp8jFAz2Q__4w7Ju7dDG93XWfCE15E15WYaXUnkYY80tStLInk7nEi6IqEPHJPUyWiyGpuYW1lU3BhY2VzoXdldS5ldXJvcGEuZWMuZXVkaS5waWQuMZbYGFhRpGZyYW5kb21Q6lwO6tOJcjKhPDMrRPrRFGhkaWdlc3RJRABsZWxlbWVudFZhbHVlGDxxZWxlbWVudElkZW50aWZpZXJsYWdlX2luX3llYXJz2BhYT6RmcmFuZG9tUBwuvU0MGGbT2h94xazpeqloZGlnZXN0SUQBbGVsZW1lbnRWYWx1ZfVxZWxlbWVudElkZW50aWZpZXJrYWdlX292ZXJfMTLYGFhdpGZyYW5kb21Qo6kOsHqedb_9xHVlfCXHf2hkaWdlc3RJRAJsZWxlbWVudFZhbHVlZTUxMTQ3cWVsZW1lbnRJZGVudGlmaWVydHJlc2lkZW50X3Bvc3RhbF9jb2Rl2BhYVaRmcmFuZG9tUP6aK3BnaJ4ssYCnhgPSaZpoZGlnZXN0SUQDbGVsZW1lbnRWYWx1ZWZCRVJMSU5xZWxlbWVudElkZW50aWZpZXJrYmlydGhfcGxhY2XYGFhPpGZyYW5kb21QGR_ZD_ylLFjp_gFyoXxR0WhkaWdlc3RJRARsZWxlbWVudFZhbHVl9XFlbGVtZW50SWRlbnRpZmllcmthZ2Vfb3Zlcl8xNNgYWFWkZnJhbmRvbVByTlMf_mCOUvaECM5veox_aGRpZ2VzdElEBWxlbGVtZW50VmFsdWViREVxZWxlbWVudElkZW50aWZpZXJvaXNzdWluZ19jb3VudHJ52BhYY6RmcmFuZG9tUED3uH1EYolIFfAdQr8v6pVoZGlnZXN0SUQGbGVsZW1lbnRWYWx1ZcB0MTk2NC0wOC0xMlQwMDowMDowMFpxZWxlbWVudElkZW50aWZpZXJqYmlydGhfZGF0ZdgYWE-kZnJhbmRvbVBucDIRMDGt1bMXZVQopw3OaGRpZ2VzdElEB2xlbGVtZW50VmFsdWX0cWVsZW1lbnRJZGVudGlmaWVya2FnZV9vdmVyXzY12BhYVqRmcmFuZG9tUEQqTillqXQcpIwC8F2YOMloZGlnZXN0SUQIbGVsZW1lbnRWYWx1ZWJERXFlbGVtZW50SWRlbnRpZmllcnByZXNpZGVudF9jb3VudHJ52BhYT6RmcmFuZG9tUMoKXZZ4ZDwVRRL4IQ7oDEFoZGlnZXN0SUQJbGVsZW1lbnRWYWx1ZfVxZWxlbWVudElkZW50aWZpZXJrYWdlX292ZXJfMTbYGFhXpGZyYW5kb21QdJ-5Oz_55VjO0LOBbnoLs2hkaWdlc3RJRApsZWxlbWVudFZhbHVlYkRFcWVsZW1lbnRJZGVudGlmaWVycWlzc3VpbmdfYXV0aG9yaXR52BhYa6RmcmFuZG9tUMexUIlyfvCgcIUu67OBH6doZGlnZXN0SUQLbGVsZW1lbnRWYWx1ZcB4GDIwMjUtMDItMThUMTQ6MTI6MDQuMzc1WnFlbGVtZW50SWRlbnRpZmllcm1pc3N1YW5jZV9kYXRl2BhYVKRmcmFuZG9tUJ_7jstnoovdbm84Cmh2etFoZGlnZXN0SUQMbGVsZW1lbnRWYWx1ZRkHrHFlbGVtZW50SWRlbnRpZmllcm5hZ2VfYmlydGhfeWVhctgYWFmkZnJhbmRvbVAnc4IFpUS4gxjqo-1DsQNvaGRpZ2VzdElEDWxlbGVtZW50VmFsdWVqTVVTVEVSTUFOTnFlbGVtZW50SWRlbnRpZmllcmtmYW1pbHlfbmFtZdgYWE-kZnJhbmRvbVD0dq9e6pNoaa0e_tVlZ-hZaGRpZ2VzdElEDmxlbGVtZW50VmFsdWX1cWVsZW1lbnRJZGVudGlmaWVya2FnZV9vdmVyXzE42BhYU6RmcmFuZG9tUIurbtyPoiia4qsc62iQHIBoZGlnZXN0SUQPbGVsZW1lbnRWYWx1ZWVFUklLQXFlbGVtZW50SWRlbnRpZmllcmpnaXZlbl9uYW1l2BhYY6RmcmFuZG9tUKgfL0gkbSOApy2APkdkNatoZGlnZXN0SUQQbGVsZW1lbnRWYWx1ZXBIRUlERVNUUkHhup5FIDE3cWVsZW1lbnRJZGVudGlmaWVyb3Jlc2lkZW50X3N0cmVldNgYWFGkZnJhbmRvbVA3gWJEwZz8jgsLsfRJvjMQaGRpZ2VzdElEEWxlbGVtZW50VmFsdWViREVxZWxlbWVudElkZW50aWZpZXJrbmF0aW9uYWxpdHnYGFhPpGZyYW5kb21QHSMBCaBxBPPy92dCcmoZvWhkaWdlc3RJRBJsZWxlbWVudFZhbHVl9XFlbGVtZW50SWRlbnRpZmllcmthZ2Vfb3Zlcl8yMdgYWFakZnJhbmRvbVB4Df01yH0SBmag1gS4xKL9aGRpZ2VzdElEE2xlbGVtZW50VmFsdWVlS8OWTE5xZWxlbWVudElkZW50aWZpZXJtcmVzaWRlbnRfY2l0edgYWFukZnJhbmRvbVDxOTqapogRuHVS1cLoK7z6aGRpZ2VzdElEFGxlbGVtZW50VmFsdWVmR0FCTEVScWVsZW1lbnRJZGVudGlmaWVycWZhbWlseV9uYW1lX2JpcnRo2BhYaaRmcmFuZG9tUOFMkL6pWaVejQQEv7_aS-loZGlnZXN0SUQVbGVsZW1lbnRWYWx1ZcB4GDIwMjUtMDMtMDRUMTQ6MTI6MDQuMzc1WnFlbGVtZW50SWRlbnRpZmllcmtleHBpcnlfZGF0ZQ`;

const sdJwtCredentialIssuedByWalletEnterprise = `eyJ0eXAiOiJ2YytzZC1qd3QiLCJ2Y3RtIjpbImV5SjJZM1FpT2lKMWNtNDZaWFV1WlhWeWIzQmhMbVZqTG1WMVpHazZjR2xrT2pFaUxDSnVZVzFsSWpvaVZtVnlhV1pwWVdKc1pTQkpSQ0lzSW1SbGMyTnlhWEIwYVc5dUlqb2lWR2hwY3lCcGN5QmhJRlpsY21sbWFXRmliR1VnU1VRZ1pHOWpkVzFsYm5RZ2FYTnpkV1ZrSUdKNUlIUm9aU0IzWld4c0lHdHViM2R1SUZaSlJDQkpjM04xWlhJaUxDSmthWE53YkdGNUlqcGJleUpzWVc1bklqb2laVzR0VlZNaUxDSnVZVzFsSWpvaVZtVnlhV1pwWVdKc1pTQkpSQ0lzSW5KbGJtUmxjbWx1WnlJNmV5SnphVzF3YkdVaU9uc2liRzluYnlJNmV5SjFjbWtpT2lKb2RIUndPaTh2ZDJGc2JHVjBMV1Z1ZEdWeWNISnBjMlV0YVhOemRXVnlPamd3TURNdmFXMWhaMlZ6TDJ4dloyOHVjRzVuSWl3aWRYSnBJMmx1ZEdWbmNtbDBlU0k2SW5Ob1lUSTFOaTFoWTJSaE16UXdOR015WTJZME5tUmhNVGt5WTJZeU5EVmpZMk0yWWpreFpXUmpaVGc0TmpreE1qSm1ZVFZoTmpZek5qSTROR1l4WVRZd1ptWmpaRGcySWl3aVlXeDBYM1JsZUhRaU9pSldTVVFnVEc5bmJ5SjlMQ0ppWVdOclozSnZkVzVrWDJOdmJHOXlJam9pSXpSall6TmtaQ0lzSW5SbGVIUmZZMjlzYjNJaU9pSWpSa1pHUmtaR0luMHNJbk4yWjE5MFpXMXdiR0YwWlhNaU9sdDdJblZ5YVNJNkltaDBkSEE2THk5M1lXeHNaWFF0Wlc1MFpYSndjbWx6WlMxcGMzTjFaWEk2T0RBd015OXBiV0ZuWlhNdmRHVnRjR3hoZEdVdGNHbGtMbk4yWnlKOVhYMTlYU3dpWTJ4aGFXMXpJanBiZXlKd1lYUm9JanBiSW1kcGRtVnVYMjVoYldVaVhTd2laR2x6Y0d4aGVTSTZXM3NpYkdGdVp5STZJbVZ1TFZWVElpd2liR0ZpWld3aU9pSkhhWFpsYmlCT1lXMWxJaXdpWkdWelkzSnBjSFJwYjI0aU9pSlVhR1VnWjJsMlpXNGdibUZ0WlNCdlppQjBhR1VnVmtsRUlHaHZiR1JsY2lKOVhTd2ljM1puWDJsa0lqb2laMmwyWlc1ZmJtRnRaU0o5TEhzaWNHRjBhQ0k2V3lKbVlXMXBiSGxmYm1GdFpTSmRMQ0prYVhOd2JHRjVJanBiZXlKc1lXNW5Jam9pWlc0dFZWTWlMQ0pzWVdKbGJDSTZJa1poYldsc2VTQk9ZVzFsSWl3aVpHVnpZM0pwY0hScGIyNGlPaUpVYUdVZ1ptRnRhV3g1SUc1aGJXVWdiMllnZEdobElGWkpSQ0JvYjJ4a1pYSWlmVjBzSW5OMloxOXBaQ0k2SW1aaGJXbHNlVjl1WVcxbEluMHNleUp3WVhSb0lqcGJJbUpwY25Sb1gyUmhkR1VpWFN3aVpHbHpjR3hoZVNJNlczc2liR0Z1WnlJNkltVnVMVlZUSWl3aWJHRmlaV3dpT2lKQ2FYSjBhQ0JrWVhSbElpd2laR1Z6WTNKcGNIUnBiMjRpT2lKVWFHVWdZbWx5ZEdnZ1pHRjBaU0J2WmlCMGFHVWdWa2xFSUdodmJHUmxjaUo5WFN3aWMzWm5YMmxrSWpvaVltbHlkR2hmWkdGMFpTSjlMSHNpY0dGMGFDSTZXeUpwYzNOMWFXNW5YMkYxZEdodmNtbDBlU0pkTENKa2FYTndiR0Y1SWpwYmV5SnNZVzVuSWpvaVpXNHRWVk1pTENKc1lXSmxiQ0k2SWtsemMzVnBibWNnWVhWMGFHOXlhWFI1SWl3aVpHVnpZM0pwY0hScGIyNGlPaUpVYUdVZ2FYTnpkV2x1WnlCaGRYUm9iM0pwZEhrZ2IyWWdkR2hsSUZaSlJDQmpjbVZrWlc1MGFXRnNJbjFkTENKemRtZGZhV1FpT2lKcGMzTjFhVzVuWDJGMWRHaHZjbWwwZVNKOUxIc2ljR0YwYUNJNld5SnBjM04xWVc1alpWOWtZWFJsSWwwc0ltUnBjM0JzWVhraU9sdDdJbXhoYm1jaU9pSmxiaTFWVXlJc0lteGhZbVZzSWpvaVNYTnpkV0Z1WTJVZ1pHRjBaU0lzSW1SbGMyTnlhWEIwYVc5dUlqb2lWR2hsSUdSaGRHVWdkR2hoZENCMGFHVWdZM0psWkdWdWRHbGhiQ0IzWVhNZ2FYTnpkV1ZrSW4xZExDSnpkbWRmYVdRaU9pSnBjM04xWVc1alpWOWtZWFJsSW4wc2V5SndZWFJvSWpwYkltVjRjR2x5ZVY5a1lYUmxJbDBzSW1ScGMzQnNZWGtpT2x0N0lteGhibWNpT2lKbGJpMVZVeUlzSW14aFltVnNJam9pU1hOemRXRnVZMlVnWkdGMFpTSXNJbVJsYzJOeWFYQjBhVzl1SWpvaVZHaGxJR1JoZEdVZ2RHaGhkQ0IwYUdVZ1kzSmxaR1Z1ZEdsaGJDQjNhV3hzSUdWNGNHbHlaU0o5WFN3aWMzWm5YMmxrSWpvaVpYaHdhWEo1WDJSaGRHVWlmVjE5Il0sIng1YyI6WyJNSUlDUkRDQ0FldWdBd0lCQWdJVUVRZzNOVzdBVHJFeFpWUWRSZjdPeXpZYnAzMHdDZ1lJS29aSXpqMEVBd0l3VWpFTE1Ba0dBMVVFQmhNQ1IxSXhEekFOQmdOVkJBZ01Ca2R5WldWalpURVBNQTBHQTFVRUJ3d0dRWFJvWlc1ek1RNHdEQVlEVlFRS0RBVkhWVzVsZERFUk1BOEdBMVVFQXd3SWQzZFhZV3hzWlhRd0hoY05NalV3TWpJMk1UVXhOak16V2hjTk16VXdNakkwTVRVeE5qTXpXakIxTVFzd0NRWURWUVFHRXdKSFVqRVBNQTBHQTFVRUNBd0dSM0psWldObE1ROHdEUVlEVlFRSERBWkJkR2hsYm5NeERqQU1CZ05WQkFvTUJVZFZibVYwTVJFd0R3WURWUVFMREFoSlpHVnVkR2wwZVRFaE1COEdBMVVFQXd3WVYyRnNiR1YwSUVWdWRHVnljSEpwYzJVZ1NYTnpkV1Z5TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFU1YvSXlnUnJVVjJNNEIxTUEra0JFYVoyTllUV1Q1bHdKbWF5Y09KNEJyYkJoY0w0eDVncE1GVHdZdUprK043cGVWZ25mendOWDZEeU9mK3lkNTJvbmFOOE1Ib3dDUVlEVlIwVEJBSXdBREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUZCd01DTUIwR0ExVWREZ1FXQkJUdXJUbi8yK1hVNkdic3UvZ1RsZDRadU9CaGpUQWZCZ05WSFNNRUdEQVdnQlI4ZVBodlBLK2ppNmNmS3dhMzZrMXJSZXdGb2pBS0JnZ3Foa2pPUFFRREFnTkhBREJFQWlBcURoL1l0S1RPa29YaEZmRVFQMU0rOUxOQi9IcTliWGo4TWt6MHZhWElQd0lnYW82dTE2NlhjdDB1YS9NcXUzUHlvRis2aHlWUVVGb1FWY3dRdWsyNC95QT0iXSwiYWxnIjoiRVMyNTYifQ.eyJjbmYiOnsiandrIjp7ImNydiI6IlAtMjU2IiwiZXh0Ijp0cnVlLCJrZXlfb3BzIjpbInZlcmlmeSJdLCJrdHkiOiJFQyIsIngiOiJjalZ6T3RUUXEwbTNqS3pfS251Ql9EUERlQ0FjbTlRcm9rM3JVTTgzUjRjIiwieSI6ImpON2dhd1dOOVFFZ1l5cENQQ19KelV6YXFxYWRyRmpoOGJXa213NUNMYjgifX0sInZjdCI6InVybjpldS5ldXJvcGEuZWMuZXVkaTpwaWQ6MSIsImp0aSI6InVybjp2aWQ6OTU2MTFhMWUtNzNjZi00ZmE3LThhMjctZjE0YzgyNTFhNTRlIiwiaWF0IjoxNzQxMTA2OTc1LCJleHAiOjE3NzI2NDI5NzUsImlzcyI6Imh0dHA6Ly93YWxsZXQtZW50ZXJwcmlzZS1pc3N1ZXI6ODAwMyIsInN1YiI6Ilhxcko1My13anNCWjNBUmlzQnJ1dmRwRk9qdnRSWGxMZzNmUWJuZmJfbVUiLCJfc2RfYWxnIjoic2hhLTI1NiIsIl9zZCI6WyItalZ2ZTM4RnNxUkRLU0hFNDlfSGJadHJYZ3VBQTFWV0dKaU00dGZCU0xZIiwiMEZ5Y1hhNzVNcTNyUHBqR1FLM0lrV3N6d0tZYmVCSnAwYndIYWl2MkcyTSIsIjRGSTAwV1JnOFFCR2ZoemtLYmdGNTM3N29DSHZ3TUlKSmFOTTVLUmNMTzgiLCI3VjN4LXhtS2MzemNBd0JVcm0ycDAzZGVkX1U2RUVmM3dqaVROd1dLeE9jIiwiOEg4M0FNQjh0NUtxVmRkcmNIbldPN0s4aUVYbXNBU0w3ZlpPd2Vnc04wMCIsIkVRMGVfcE9sOUJ0emRneWJoVnlScWxvMDdzbmo4N0Vab3h5NVIzcXktbW8iLCJGNm95UmdhSDBDalRxcVFIRjBKUVNVVGhpdnZPZV8xWEhicDdmbXFSWHlzIiwiSEMyRXR2cGl3MktVd0NSOE12N3ZpZU9obzV2Vk5WQVJrdVFzeW9kR3lTZyIsIk90MDAtTjhMNG1sdTF5cXJNTHhfTmZCT29RT1FSaWdYQWhnX0Q4STlFYnMiLCJfdm5NYU5WZ0JrTUpybmd0UEZwVkpsZ0h5djFPdUhiZWRSU2pWVWk1SVRzIiwiZGUzbWhlMHZCV0NVWkxfdThrNi1CN2hlb0NqOHYwaG9BUjFISUl5ajBUayIsImZlWnd1bkdERG8xdi13dE1XNUpwX21TUnNfbmM1MC01UGYwUmlrTXhpaFEiLCJtV1BzRF96UWFLclBNS1NkdEhocTNmR0xKaVJOenlWdEFWVjZ3U2RUZEtVIiwicTR5UWZJMl9NWVVKcGl6VWF3bUNCczlYYnBNVk43NjNueFZ5aHBQR1M1TSIsInJGUW9QSVJ5OFM1R3BkWjR5OTRSTV9NUUpDQ3Mzamh4anE1SDZNYzFIU2MiLCJyYzd4a1hEcVk3c3VBYlg3MmpLMC12ZEpNRi1tem5ZZXpkR1ktMzBiblZBIiwidER4NU1vODNtWXpNbElVZlpVaDgxdWZORTNydzZRa0dCNjRidEdqRmtBYyJdfQ.-B1l8lRrWnvVFwtMW4AC02wNR6DxHmAwPkbHeLAGd_GFqbx7SiKPgNUNw-xr1A8U73yIxC4iAWXt3CLFn4GKHg~WyJGNVhBVE1LNlBjY1ZNeXcwcUs5VmhnIiwiZmFtaWx5X25hbWUiLCJEb2UiXQ~WyJWMWxFek91bWxIclc0R1Z6M3FTWDh3IiwiZmFtaWx5X25hbWVfYmlydGgiLCJEb2UiXQ~WyJNX1ViMUZWYnphTjhVUEV1QlZ2VkN3IiwiZ2l2ZW5fbmFtZSIsIkpvaG4iXQ~WyJ5azZBaGhZVDJHdDEwUUY5czFEQ1hRIiwiZ2l2ZW5fbmFtZV9iaXJ0aCIsIkpvaG4iXQ~WyJEcEpiWlZuSWVXY3JEekJCNlUtaDVnIiwiYmlydGhfZGF0ZSIsIjE5OTAtMTAtMTUiXQ~WyJNd016YXRvNndLb3NWN2lqazVQMjBRIiwiaXNzdWluZ19hdXRob3JpdHkiLCJQSUQ6MDAwMDEiXQ~WyI4a2N5Y3EtQ1g4NWhxRUhyU3h2ZjN3IiwiaXNzdWluZ19jb3VudHJ5IiwiR1IiXQ~WyIxOXI2TGdEVnpmZGRzSDJPODRfWjNRIiwiZG9jdW1lbnRfbnVtYmVyIiwiMTIzMTMyMTMiXQ~WyI1OE51c1lITGd3T2FlZlp3UjEtN0JBIiwiaXNzdWFuY2VfZGF0ZSIsIjIwMjUtMDMtMDQiXQ~WyJ3Qy1remJxM1E2LUZJLXRWTnZ3aFFBIiwiZXhwaXJ5X2RhdGUiLCIyMDM1LTA0LTIxIl0~WyJGREg4ck1hdGVhdVg0Y1N0eHRDYjNRIiwiYWdlX292ZXJfMTgiLGZhbHNlXQ~WyJZaUFFWVNQTy1ndE1rcVRqRmc1NmlnIiwic2V4IiwxXQ~WyJrS0Y3dF92VU5qNTJ1M2hGLWgwSTlnIiwibmF0aW9uYWxpdHkiLCJVUyJd~WyJERnYyVUdaR3hmbUFXN25xRURQS0NBIiwiYmlydGhfcGxhY2UiLCJVUyJd~WyJDWDBBNFRzZDk5djF2d2cyeEtra1VRIiwicmVzaWRlbnRfYWRkcmVzcyIsIjIzLCBSYW5kb20gc3RyLiAzNDc5MyBBcHQgMyBVU0EiXQ~WyIyNzRCcHI4dmdtRFM1SUxxR0pWMXl3IiwiZW1haWxfYWRkcmVzcyIsImpvaG5Ac2FtcGxlLmNvbSJd~WyIwZHBsWEE3NDNDVm9TZmZxS1ZyclRRIiwibW9iaWxlX3Bob25lX251bWJlciIsIiszMDgzODgzMzgzODIiXQ~`;

const sdJwtCredentialIssuedByWalletEnterpriseWithKbJwt = `eyJ0eXAiOiJ2YytzZC1qd3QiLCJ2Y3RtIjpbImV5SjJZM1FpT2lKMWNtNDZaWFV1WlhWeWIzQmhMbVZqTG1WMVpHazZjR2xrT2pFaUxDSnVZVzFsSWpvaVZtVnlhV1pwWVdKc1pTQkpSQ0lzSW1SbGMyTnlhWEIwYVc5dUlqb2lWR2hwY3lCcGN5QmhJRlpsY21sbWFXRmliR1VnU1VRZ1pHOWpkVzFsYm5RZ2FYTnpkV1ZrSUdKNUlIUm9aU0IzWld4c0lHdHViM2R1SUZaSlJDQkpjM04xWlhJaUxDSmthWE53YkdGNUlqcGJleUpzWVc1bklqb2laVzR0VlZNaUxDSnVZVzFsSWpvaVZtVnlhV1pwWVdKc1pTQkpSQ0lzSW5KbGJtUmxjbWx1WnlJNmV5SnphVzF3YkdVaU9uc2liRzluYnlJNmV5SjFjbWtpT2lKb2RIUndPaTh2ZDJGc2JHVjBMV1Z1ZEdWeWNISnBjMlV0YVhOemRXVnlPamd3TURNdmFXMWhaMlZ6TDJ4dloyOHVjRzVuSWl3aWRYSnBJMmx1ZEdWbmNtbDBlU0k2SW5Ob1lUSTFOaTFoWTJSaE16UXdOR015WTJZME5tUmhNVGt5WTJZeU5EVmpZMk0yWWpreFpXUmpaVGc0TmpreE1qSm1ZVFZoTmpZek5qSTROR1l4WVRZd1ptWmpaRGcySWl3aVlXeDBYM1JsZUhRaU9pSldTVVFnVEc5bmJ5SjlMQ0ppWVdOclozSnZkVzVrWDJOdmJHOXlJam9pSXpSall6TmtaQ0lzSW5SbGVIUmZZMjlzYjNJaU9pSWpSa1pHUmtaR0luMHNJbk4yWjE5MFpXMXdiR0YwWlhNaU9sdDdJblZ5YVNJNkltaDBkSEE2THk5M1lXeHNaWFF0Wlc1MFpYSndjbWx6WlMxcGMzTjFaWEk2T0RBd015OXBiV0ZuWlhNdmRHVnRjR3hoZEdVdGNHbGtMbk4yWnlKOVhYMTlYU3dpWTJ4aGFXMXpJanBiZXlKd1lYUm9JanBiSW1kcGRtVnVYMjVoYldVaVhTd2laR2x6Y0d4aGVTSTZXM3NpYkdGdVp5STZJbVZ1TFZWVElpd2liR0ZpWld3aU9pSkhhWFpsYmlCT1lXMWxJaXdpWkdWelkzSnBjSFJwYjI0aU9pSlVhR1VnWjJsMlpXNGdibUZ0WlNCdlppQjBhR1VnVmtsRUlHaHZiR1JsY2lKOVhTd2ljM1puWDJsa0lqb2laMmwyWlc1ZmJtRnRaU0o5TEhzaWNHRjBhQ0k2V3lKbVlXMXBiSGxmYm1GdFpTSmRMQ0prYVhOd2JHRjVJanBiZXlKc1lXNW5Jam9pWlc0dFZWTWlMQ0pzWVdKbGJDSTZJa1poYldsc2VTQk9ZVzFsSWl3aVpHVnpZM0pwY0hScGIyNGlPaUpVYUdVZ1ptRnRhV3g1SUc1aGJXVWdiMllnZEdobElGWkpSQ0JvYjJ4a1pYSWlmVjBzSW5OMloxOXBaQ0k2SW1aaGJXbHNlVjl1WVcxbEluMHNleUp3WVhSb0lqcGJJbUpwY25Sb1gyUmhkR1VpWFN3aVpHbHpjR3hoZVNJNlczc2liR0Z1WnlJNkltVnVMVlZUSWl3aWJHRmlaV3dpT2lKQ2FYSjBhQ0JrWVhSbElpd2laR1Z6WTNKcGNIUnBiMjRpT2lKVWFHVWdZbWx5ZEdnZ1pHRjBaU0J2WmlCMGFHVWdWa2xFSUdodmJHUmxjaUo5WFN3aWMzWm5YMmxrSWpvaVltbHlkR2hmWkdGMFpTSjlMSHNpY0dGMGFDSTZXeUpwYzNOMWFXNW5YMkYxZEdodmNtbDBlU0pkTENKa2FYTndiR0Y1SWpwYmV5SnNZVzVuSWpvaVpXNHRWVk1pTENKc1lXSmxiQ0k2SWtsemMzVnBibWNnWVhWMGFHOXlhWFI1SWl3aVpHVnpZM0pwY0hScGIyNGlPaUpVYUdVZ2FYTnpkV2x1WnlCaGRYUm9iM0pwZEhrZ2IyWWdkR2hsSUZaSlJDQmpjbVZrWlc1MGFXRnNJbjFkTENKemRtZGZhV1FpT2lKcGMzTjFhVzVuWDJGMWRHaHZjbWwwZVNKOUxIc2ljR0YwYUNJNld5SnBjM04xWVc1alpWOWtZWFJsSWwwc0ltUnBjM0JzWVhraU9sdDdJbXhoYm1jaU9pSmxiaTFWVXlJc0lteGhZbVZzSWpvaVNYTnpkV0Z1WTJVZ1pHRjBaU0lzSW1SbGMyTnlhWEIwYVc5dUlqb2lWR2hsSUdSaGRHVWdkR2hoZENCMGFHVWdZM0psWkdWdWRHbGhiQ0IzWVhNZ2FYTnpkV1ZrSW4xZExDSnpkbWRmYVdRaU9pSnBjM04xWVc1alpWOWtZWFJsSW4wc2V5SndZWFJvSWpwYkltVjRjR2x5ZVY5a1lYUmxJbDBzSW1ScGMzQnNZWGtpT2x0N0lteGhibWNpT2lKbGJpMVZVeUlzSW14aFltVnNJam9pU1hOemRXRnVZMlVnWkdGMFpTSXNJbVJsYzJOeWFYQjBhVzl1SWpvaVZHaGxJR1JoZEdVZ2RHaGhkQ0IwYUdVZ1kzSmxaR1Z1ZEdsaGJDQjNhV3hzSUdWNGNHbHlaU0o5WFN3aWMzWm5YMmxrSWpvaVpYaHdhWEo1WDJSaGRHVWlmVjE5Il0sIng1YyI6WyJNSUlDUkRDQ0FldWdBd0lCQWdJVUVRZzNOVzdBVHJFeFpWUWRSZjdPeXpZYnAzMHdDZ1lJS29aSXpqMEVBd0l3VWpFTE1Ba0dBMVVFQmhNQ1IxSXhEekFOQmdOVkJBZ01Ca2R5WldWalpURVBNQTBHQTFVRUJ3d0dRWFJvWlc1ek1RNHdEQVlEVlFRS0RBVkhWVzVsZERFUk1BOEdBMVVFQXd3SWQzZFhZV3hzWlhRd0hoY05NalV3TWpJMk1UVXhOak16V2hjTk16VXdNakkwTVRVeE5qTXpXakIxTVFzd0NRWURWUVFHRXdKSFVqRVBNQTBHQTFVRUNBd0dSM0psWldObE1ROHdEUVlEVlFRSERBWkJkR2hsYm5NeERqQU1CZ05WQkFvTUJVZFZibVYwTVJFd0R3WURWUVFMREFoSlpHVnVkR2wwZVRFaE1COEdBMVVFQXd3WVYyRnNiR1YwSUVWdWRHVnljSEpwYzJVZ1NYTnpkV1Z5TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFU1YvSXlnUnJVVjJNNEIxTUEra0JFYVoyTllUV1Q1bHdKbWF5Y09KNEJyYkJoY0w0eDVncE1GVHdZdUprK043cGVWZ25mendOWDZEeU9mK3lkNTJvbmFOOE1Ib3dDUVlEVlIwVEJBSXdBREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUZCd01DTUIwR0ExVWREZ1FXQkJUdXJUbi8yK1hVNkdic3UvZ1RsZDRadU9CaGpUQWZCZ05WSFNNRUdEQVdnQlI4ZVBodlBLK2ppNmNmS3dhMzZrMXJSZXdGb2pBS0JnZ3Foa2pPUFFRREFnTkhBREJFQWlBcURoL1l0S1RPa29YaEZmRVFQMU0rOUxOQi9IcTliWGo4TWt6MHZhWElQd0lnYW82dTE2NlhjdDB1YS9NcXUzUHlvRis2aHlWUVVGb1FWY3dRdWsyNC95QT0iXSwiYWxnIjoiRVMyNTYifQ.eyJjbmYiOnsiandrIjp7ImNydiI6IlAtMjU2IiwiZXh0Ijp0cnVlLCJrZXlfb3BzIjpbInZlcmlmeSJdLCJrdHkiOiJFQyIsIngiOiJjalZ6T3RUUXEwbTNqS3pfS251Ql9EUERlQ0FjbTlRcm9rM3JVTTgzUjRjIiwieSI6ImpON2dhd1dOOVFFZ1l5cENQQ19KelV6YXFxYWRyRmpoOGJXa213NUNMYjgifX0sInZjdCI6InVybjpldS5ldXJvcGEuZWMuZXVkaTpwaWQ6MSIsImp0aSI6InVybjp2aWQ6OTU2MTFhMWUtNzNjZi00ZmE3LThhMjctZjE0YzgyNTFhNTRlIiwiaWF0IjoxNzQxMTA2OTc1LCJleHAiOjE3NzI2NDI5NzUsImlzcyI6Imh0dHA6Ly93YWxsZXQtZW50ZXJwcmlzZS1pc3N1ZXI6ODAwMyIsInN1YiI6Ilhxcko1My13anNCWjNBUmlzQnJ1dmRwRk9qdnRSWGxMZzNmUWJuZmJfbVUiLCJfc2RfYWxnIjoic2hhLTI1NiIsIl9zZCI6WyItalZ2ZTM4RnNxUkRLU0hFNDlfSGJadHJYZ3VBQTFWV0dKaU00dGZCU0xZIiwiMEZ5Y1hhNzVNcTNyUHBqR1FLM0lrV3N6d0tZYmVCSnAwYndIYWl2MkcyTSIsIjRGSTAwV1JnOFFCR2ZoemtLYmdGNTM3N29DSHZ3TUlKSmFOTTVLUmNMTzgiLCI3VjN4LXhtS2MzemNBd0JVcm0ycDAzZGVkX1U2RUVmM3dqaVROd1dLeE9jIiwiOEg4M0FNQjh0NUtxVmRkcmNIbldPN0s4aUVYbXNBU0w3ZlpPd2Vnc04wMCIsIkVRMGVfcE9sOUJ0emRneWJoVnlScWxvMDdzbmo4N0Vab3h5NVIzcXktbW8iLCJGNm95UmdhSDBDalRxcVFIRjBKUVNVVGhpdnZPZV8xWEhicDdmbXFSWHlzIiwiSEMyRXR2cGl3MktVd0NSOE12N3ZpZU9obzV2Vk5WQVJrdVFzeW9kR3lTZyIsIk90MDAtTjhMNG1sdTF5cXJNTHhfTmZCT29RT1FSaWdYQWhnX0Q4STlFYnMiLCJfdm5NYU5WZ0JrTUpybmd0UEZwVkpsZ0h5djFPdUhiZWRSU2pWVWk1SVRzIiwiZGUzbWhlMHZCV0NVWkxfdThrNi1CN2hlb0NqOHYwaG9BUjFISUl5ajBUayIsImZlWnd1bkdERG8xdi13dE1XNUpwX21TUnNfbmM1MC01UGYwUmlrTXhpaFEiLCJtV1BzRF96UWFLclBNS1NkdEhocTNmR0xKaVJOenlWdEFWVjZ3U2RUZEtVIiwicTR5UWZJMl9NWVVKcGl6VWF3bUNCczlYYnBNVk43NjNueFZ5aHBQR1M1TSIsInJGUW9QSVJ5OFM1R3BkWjR5OTRSTV9NUUpDQ3Mzamh4anE1SDZNYzFIU2MiLCJyYzd4a1hEcVk3c3VBYlg3MmpLMC12ZEpNRi1tem5ZZXpkR1ktMzBiblZBIiwidER4NU1vODNtWXpNbElVZlpVaDgxdWZORTNydzZRa0dCNjRidEdqRmtBYyJdfQ.-B1l8lRrWnvVFwtMW4AC02wNR6DxHmAwPkbHeLAGd_GFqbx7SiKPgNUNw-xr1A8U73yIxC4iAWXt3CLFn4GKHg~WyJNX1ViMUZWYnphTjhVUEV1QlZ2VkN3IiwiZ2l2ZW5fbmFtZSIsIkpvaG4iXQ~WyJGNVhBVE1LNlBjY1ZNeXcwcUs5VmhnIiwiZmFtaWx5X25hbWUiLCJEb2UiXQ~WyJEcEpiWlZuSWVXY3JEekJCNlUtaDVnIiwiYmlydGhfZGF0ZSIsIjE5OTAtMTAtMTUiXQ~eyJ0eXAiOiJrYitqd3QiLCJhbGciOiJFUzI1NiJ9.eyJub25jZSI6IjlhMGEwNmQwLTA1NDctNDEwNi1iNGM2LTUxMTkzN2ViMDQ3ZiIsImF1ZCI6IndhbGxldC1lbnRlcnByaXNlLWFjbWUtdmVyaWZpZXIiLCJzZF9oYXNoIjoiem1jbXJEaG5USWFiTjh4WVlEbTVBOXpWalhyT25sVXNYLUM1RVh1ckFvOCIsImlhdCI6MTc0MTEwODE3Nn0.3dpDrheXKJe0tOEaU1JWsBRHQOuDsqkq6JBPzf5TFvOo3eFd4JgBMJAiUrMJDpbcaVLgBiCOyIEeXbscE03tQw`;

/**
 * This certificate was used to sign the issuer's certificate
 */
const rootCert = `-----BEGIN CERTIFICATE-----
MIICeTCCAiCgAwIBAgIUB5E9QVZtmUYcDtCjKB/H3VQv72gwCgYIKoZIzj0EAwIwgYgxCzAJBgNVBAYTAkRFMQ8wDQYDVQQHDAZCZXJsaW4xHTAbBgNVBAoMFEJ1bmRlc2RydWNrZXJlaSBHbWJIMREwDwYDVQQLDAhUIENTIElERTE2MDQGA1UEAwwtU1BSSU5EIEZ1bmtlIEVVREkgV2FsbGV0IFByb3RvdHlwZSBJc3N1aW5nIENBMB4XDTI0MDUzMTA2NDgwOVoXDTM0MDUyOTA2NDgwOVowgYgxCzAJBgNVBAYTAkRFMQ8wDQYDVQQHDAZCZXJsaW4xHTAbBgNVBAoMFEJ1bmRlc2RydWNrZXJlaSBHbWJIMREwDwYDVQQLDAhUIENTIElERTE2MDQGA1UEAwwtU1BSSU5EIEZ1bmtlIEVVREkgV2FsbGV0IFByb3RvdHlwZSBJc3N1aW5nIENBMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEYGzdwFDnc7+Kn5ibAvCOM8ke77VQxqfMcwZL8IaIA+WCROcCfmY/giH92qMru5p/kyOivE0RC/IbdMONvDoUyaNmMGQwHQYDVR0OBBYEFNRWGMCJOOgOWIQYyXZiv6u7xZC+MB8GA1UdIwQYMBaAFNRWGMCJOOgOWIQYyXZiv6u7xZC+MBIGA1UdEwEB/wQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMCA0cAMEQCIGEm7wkZKHt/atb4MdFnXW6yrnwMUT2u136gdtl10Y6hAiBuTFqvVYth1rbxzCP0xWZHmQK9kVyxn8GPfX27EIzzsw==
-----END CERTIFICATE-----`

const invalidRootCert = `-----BEGIN CERTIFICATE-----
MIICdDCCAhugAwIBAgIBAjAKBggqhkjOPQQDAjCBiDELMAkGA1UEBhMCREUxDzANBgNVBAcMBkJlcmxpbjEdMBsGA1UECgwUQnVuZGVzZHJ1Y2tlcmVpIEdtYkgxETAPBgNVBAsMCFQgQ1MgSURFMTYwNAYDVQQDDC1TUFJJTkQgRnVua2UgRVVESSBXYWxsZXQgUHJvdG90eXBlIElzc3VpbmcgQ0EwHhcNMjQwNTMxMDgxMzE3WhcNMjUwNzA1MDgxMzE3WjBsMQswCQYDVQQGEwJERTEdMBsGA1UECgwUQnVuZGVzZHJ1Y2tlcmVpIEdtYkgxCjAIBgNVBAsMAUkxMjAwBgNVBAMMKVNQUklORCBGdW5rZSBFVURJIFdhbGxldCBQcm90b3R5cGUgSXNzdWVyMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEOFBq4YMKg4w5fTifsytwBuJf/7E7VhRPXiNm52S3q1ETIgBdXyDK3kVxGxgeHPivLP3uuMvS6iDEc7qMxmvduKOBkDCBjTAdBgNVHQ4EFgQUiPhCkLErDXPLW2/J0WVeghyw+mIwDAYDVR0TAQH/BAIwADAOBgNVHQ8BAf8EBAMCB4AwLQYDVR0RBCYwJIIiZGVtby5waWQtaXNzdWVyLmJ1bmRlc2RydWNrZXJlaS5kZTAfBgNVHSMEGDAWgBTUVhjAiTjoDliEGMl2Yr+ru8WQvjAKBggqhkjOPQQDAgNHADBEAiAbf5TzkcQzhfWoIoyi1VN7d8I9BsFKm1MWluRph2byGQIgKYkdrNf2xXPjVSbjW/U/5S5vAEC5XxcOanusOBroBbU=
-----END CERTIFICATE-----`


const walletEnterpriseIssuerCaCertificate = `-----BEGIN CERTIFICATE-----
MIICCTCCAa+gAwIBAgIUOgCPRPz+xuyaJVSj4+pw5DL2pcswCgYIKoZIzj0EAwIw
UjELMAkGA1UEBhMCR1IxDzANBgNVBAgMBkdyZWVjZTEPMA0GA1UEBwwGQXRoZW5z
MQ4wDAYDVQQKDAVHVW5ldDERMA8GA1UEAwwId3dXYWxsZXQwHhcNMjUwMjI2MTUx
MjIwWhcNMzUwMjI0MTUxMjIwWjBSMQswCQYDVQQGEwJHUjEPMA0GA1UECAwGR3Jl
ZWNlMQ8wDQYDVQQHDAZBdGhlbnMxDjAMBgNVBAoMBUdVbmV0MREwDwYDVQQDDAh3
d1dhbGxldDBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABNBZtjDVXcHAETA8F1Wj
ScHMtRtfNgYZxYb+6Q5qrOBBRpT75BvaANNoASnnXSXe8HJ4HCB9XG6UuuIhuK/X
eUejYzBhMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMB0GA1UdDgQW
BBR8ePhvPK+ji6cfKwa36k1rRewFojAfBgNVHSMEGDAWgBR8ePhvPK+ji6cfKwa3
6k1rRewFojAKBggqhkjOPQQDAgNIADBFAiEAiVcSsLpcK6bkYkq03gzejgBQvvKv
nLP+NsILFBXC+I8CIHSpT1vB/tMaJKbIizZwxyOru6N/iUkpHGzVnxU5Wgu4
-----END CERTIFICATE-----`;


const context: Context = {
	clockTolerance: 0,
	lang: 'en-US',
	subtle: crypto.subtle,
	trustedCertificates: [
		rootCert,
		walletEnterpriseIssuerCaCertificate
	],
};

describe("The SDJWTVerifier", () => {

	const pkResolverEngine = PublicKeyResolverEngine();

	it("should handle the case where the input is not an SDJWT", async () => {
		const result = await SDJWTVCVerifier({ context, pkResolverEngine })
			.verify({
				rawCredential: wrongFormatCredential, opts: {}
			});

		assert(result.success === false);
		assert(result.error === CredentialVerificationError.InvalidFormat);
	});

	it("should successfully verify credential issued by Wallet Enterprise Issuer", async () => {
		const result = await SDJWTVCVerifier({ context, pkResolverEngine })
			.verify({
				rawCredential: sdJwtCredentialIssuedByWalletEnterprise, opts: {}
			});

		assert(result.success === true);
	});

	it("should successfully verify SDJWT+KBJWT issued by Wallet Enterprise Issuer", async () => {
		const result = await SDJWTVCVerifier({ context, pkResolverEngine })
			.verify({
				rawCredential: sdJwtCredentialIssuedByWalletEnterpriseWithKbJwt, opts: {
					expectedNonce: "9a0a06d0-0547-4106-b4c6-511937eb047f",
					expectedAudience: "wallet-enterprise-acme-verifier",
				}
			});

		assert(result.success === true);
	});
})
